 Begin
 for r_deposito in (
   select pcpopcomponente.empresa, pcpopcomponente.deposito_baixa, pcpopcomponente.op, 
          pcpopcomponente.etapa_aplicacao, pcpopcomponente.componente, pcpopcomponente.quantidade_aplicada, pcpopcomponente.total_aplicado,
          nvl(pcpopgrupocomp.aplicador,0) aplicador, pcpopgrupocomp.seq_grupo, pcpop.peso
     from pcpoprecurso, pcpopcomponente, estitem, pcpopgrupocomp, pcpop
    where pcpoprecurso.empresa = 1
      and pcpoprecurso.situacao = 'F'
      and pcpoprecurso.etapa = 20
      and pcpoprecurso.empresa = pcpopcomponente.empresa
      and pcpoprecurso.op = pcpopcomponente.op
      and pcpoprecurso.etapa = nvl(pcpopcomponente.etapa_aplicacao,20)
--    and pcpopcomponente.deposito_baixa <> 33
      and pcpoprecurso.imprime = 'S'
      and pcpopcomponente.empresa = estitem.empresa
      and pcpopcomponente.componente = estitem.codigo
      and pcpopcomponente.empresa = pcpopgrupocomp.empresa
      and pcpopcomponente.seq_grupo = pcpopgrupocomp.seq_grupo
      and pcpopcomponente.op = pcpopgrupocomp.op
      and pcpopcomponente.empresa = pcpop.empresa
      and pcpopcomponente.op = pcpop.op
      and estitem.tipo_item in (11,33))

        loop
         if r_deposito.quantidade_aplicada <= 0 and r_deposito.aplicador <= 0 then
           update pcpopcomponente 
              set deposito_baixa = 33, quantidade_aplicada = 0.1, total_aplicado = 0.1/100 * r_deposito.peso
            where empresa = r_deposito.empresa 
              and op = r_deposito.op
              and nvl(etapa_aplicacao,20) = nvl(r_deposito.etapa_aplicacao,20)
              and deposito_baixa = r_deposito.deposito_baixa
              and componente = r_deposito.componente;
              
           update pcpopgrupocomp
              set aplicador = 2
            where empresa = r_deposito.empresa
              and op = r_deposito.op
              and seq_grupo = r_deposito.seq_grupo
              and aplicador is null;

         elsif r_deposito.quantidade_aplicada > 0 and r_deposito.aplicador = 0 then
           update pcpopcomponente 
              set deposito_baixa = 33, total_aplicado = quantidade_aplicada/100*r_deposito.peso
            where empresa = r_deposito.empresa 
              and op = r_deposito.op
              and nvl(etapa_aplicacao,20) = nvl(r_deposito.etapa_aplicacao,20)
              and deposito_baixa = r_deposito.deposito_baixa
              and componente = r_deposito.componente;

           update pcpopgrupocomp
              set aplicador = 2
            where empresa = r_deposito.empresa
              and op = r_deposito.op
              and seq_grupo = r_deposito.seq_grupo
              and aplicador is null;
              
          elsif r_deposito.quantidade_aplicada = 0 and r_deposito.aplicador <> 0 then
           update pcpopcomponente 
              set deposito_baixa = 33, quantidade_aplicada = 0.1, total_aplicado = 0.1/100 * r_deposito.peso
            where empresa = r_deposito.empresa 
              and op = r_deposito.op
              and nvl(etapa_aplicacao,20) = nvl(r_deposito.etapa_aplicacao,20)
              and deposito_baixa = r_deposito.deposito_baixa
              and componente = r_deposito.componente;
              
           update pcpopgrupocomp
              set aplicador = 2
            where empresa = r_deposito.empresa
              and op = r_deposito.op
              and seq_grupo = r_deposito.seq_grupo
              and aplicador is null;

            elsif r_deposito.quantidade_aplicada > 0 and r_deposito.total_aplicado = 0 then
             update pcpopcomponente 
                set deposito_baixa = 33, total_aplicado = quantidade_aplicada/100*r_deposito.peso
              where empresa = r_deposito.empresa 
                and op = r_deposito.op
                and nvl(etapa_aplicacao,20) = nvl(r_deposito.etapa_aplicacao,20)
                and deposito_baixa = r_deposito.deposito_baixa
                and componente = r_deposito.componente;

           update pcpopgrupocomp
              set aplicador = 2
            where empresa = r_deposito.empresa
              and op = r_deposito.op
              and seq_grupo = r_deposito.seq_grupo
              and aplicador is null;                
                
           else 
             update pcpopcomponente 
                set deposito_baixa = 33
              where empresa = r_deposito.empresa 
                and op = r_deposito.op
                and nvl(etapa_aplicacao,20) = nvl(r_deposito.etapa_aplicacao,20)
                and deposito_baixa = r_deposito.deposito_baixa
                and componente = r_deposito.componente;
                
           update pcpopgrupocomp
              set aplicador = 2
            where empresa = r_deposito.empresa
              and op = r_deposito.op
              and seq_grupo = r_deposito.seq_grupo
              and aplicador is null;
                
          end if;
             
        end loop;

--Instrução Alteração Insumos Base
  for r_tintas in (select pcpopcomponente.empresa, pcpopcomponente.deposito_baixa, pcpopcomponente.op, 
                          pcpopcomponente.etapa_aplicacao, pcpopcomponente.componente, pcpopcomponente.quantidade_aplicada, pcpopcomponente.total_aplicado,
                          nvl(pcpopgrupocomp.aplicador,0) aplicador, pcpopgrupocomp.seq_grupo, pcpop.peso
                     from pcpoprecurso, pcpopcomponente, estitem, pcpopgrupocomp, pcpop
                    where pcpoprecurso.empresa = 1
                      and pcpoprecurso.situacao = 'F'
                      and pcpoprecurso.etapa = 100
                      and pcpoprecurso.empresa = pcpopcomponente.empresa
                      and pcpoprecurso.op = pcpopcomponente.op
                    --  and pcpoprecurso.etapa = nvl(pcpopcomponente.etapa_aplicacao,100)
                      and pcpopcomponente.deposito_baixa <> 33
                      and pcpopcomponente.empresa = estitem.empresa
                      and pcpopcomponente.componente = estitem.codigo
                      and pcpopcomponente.empresa = pcpopgrupocomp.empresa
                      and pcpopcomponente.seq_grupo = pcpopgrupocomp.seq_grupo
                      and pcpopcomponente.op = pcpopgrupocomp.op
                      and pcpopcomponente.empresa = pcpop.empresa
                      and pcpopcomponente.op = pcpop.op
                      and estitem.tipo_item in (21))
                      
                      loop
                         update pcpopcomponente set etapa_aplicacao = 100, deposito_baixa =33
                          where empresa = r_tintas.empresa
                            and op = r_tintas.op;
                          --  and deposito_baixa = r_tintas.deposito_baixa
                          --  and etapa_aplicacao = r_tintas.etapa_aplicacao;
                      end loop;

end;
